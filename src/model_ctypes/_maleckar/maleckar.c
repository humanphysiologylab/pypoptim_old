#include "./maleckar.h"
#include "math.h"


void calc_fluo(double VOI, double* CONSTANTS, double* RATES, double* STATES, double* ALGEBRAIC) {
    const double fluo_tot = CONSTANTS[51];
    const double k_on = CONSTANTS[52], k_off = CONSTANTS[53];

    int i_fluo_array[] = {30, 31}; // *_d, *_i
    int i_Ca_array[]   = {6,  19};

    for (int i = 0; i < 2; ++i) {

        int  i_fluo = i_fluo_array[i], i_Cai = i_Ca_array[i];

        double fluo = STATES[i_fluo],    Cai = STATES[i_Cai];

        RATES[i_fluo] = k_on * Cai * (fluo_tot - fluo) - k_off * fluo;
        RATES[i_Cai] -= RATES[i_fluo];
    }
}


void _calc_means(double *STATES, const double *CONSTANTS) {
    double Vol_i = CONSTANTS[29], Vol_d = CONSTANTS[30];
    double Vsum = Vol_i + Vol_d;

    double Ca_i = STATES[19], Ca_d = STATES[6];
    double fluo_i = STATES[31], fluo_d = STATES[30];

    double Cai_mean  = (Ca_i   * Vol_i   +   Ca_d   * Vol_d) / Vsum;
    double fluo_mean = (fluo_i * Vol_i   +   fluo_d * Vol_d) / Vsum;

    STATES[32] = Cai_mean;
    STATES[33] = fluo_mean;

}


void calc_means(double VOI, double* CONSTANTS, double* RATES, double* STATES, double* ALGEBRAIC) {
    RATES[32] = 0;
    RATES[33] = 0;
}


void computeRates(double VOI, double* CONSTANTS, double* RATES, double* STATES, double* ALGEBRAIC) {
ALGEBRAIC[12] =  2000.00*CONSTANTS[32]*((1.00000 - STATES[22]) - STATES[23]) -  666.000*STATES[23];
RATES[23] = ALGEBRAIC[12];
ALGEBRAIC[18] =  0.00350000*exp((( - STATES[0]*STATES[0])/30.0000)/30.0000)+0.00150000;
ALGEBRAIC[6] = 1.00000/(1.00000+exp((STATES[0] - 1.00000)/- 11.0000));
RATES[12] = (ALGEBRAIC[6] - STATES[12])/ALGEBRAIC[18];
ALGEBRAIC[8] = 1.00000/(1.00000+exp(- (STATES[0]+6.00000)/8.60000));
ALGEBRAIC[20] = 0.00900000/(1.00000+exp((STATES[0]+5.00000)/12.0000))+0.000500000;
RATES[14] = (ALGEBRAIC[8] - STATES[14])/ALGEBRAIC[20];
ALGEBRAIC[9] = 1.00000/(1.00000+exp((STATES[0]+7.50000)/10.0000));
ALGEBRAIC[21] = 0.590000/(1.00000+exp((STATES[0]+60.0000)/10.0000))+3.05000;
RATES[15] = (ALGEBRAIC[9] - STATES[15])/ALGEBRAIC[21];
ALGEBRAIC[14] = 1.00000/(1.00000+exp((STATES[0]+27.1200)/- 8.21000));
ALGEBRAIC[2] = (STATES[0]+25.5700)/28.8000;
ALGEBRAIC[26] =  4.20000e-05*exp( - ALGEBRAIC[2]*ALGEBRAIC[2])+2.40000e-05;
RATES[3] = (ALGEBRAIC[14] - STATES[3])/ALGEBRAIC[26];
ALGEBRAIC[3] = 1.00000/(1.00000+exp((STATES[0]+63.6000)/5.30000));
ALGEBRAIC[15] = 1.00000/(1.00000+exp((STATES[0]+35.1000)/3.20000));
ALGEBRAIC[27] =  0.0300000*ALGEBRAIC[15]+0.000300000;
RATES[4] = (ALGEBRAIC[3] - STATES[4])/ALGEBRAIC[27];
ALGEBRAIC[28] =  0.120000*ALGEBRAIC[15]+0.00300000;
RATES[5] = (ALGEBRAIC[3] - STATES[5])/ALGEBRAIC[28];
ALGEBRAIC[4] = 1.00000/(1.00000+exp((STATES[0]+9.00000)/- 5.80000));
ALGEBRAIC[16] = (STATES[0]+35.0000)/30.0000;
ALGEBRAIC[29] =  0.00270000*exp( - ALGEBRAIC[16]*ALGEBRAIC[16])+0.00200000;
RATES[7] = (ALGEBRAIC[4] - STATES[7])/ALGEBRAIC[29];
ALGEBRAIC[5] = 1.00000/(1.00000+exp((STATES[0]+27.4000)/7.10000));
ALGEBRAIC[17] = STATES[0]+40.0000;
ALGEBRAIC[30] =  0.161000*exp((( - ALGEBRAIC[17]*ALGEBRAIC[17])/14.4000)/14.4000)+0.0100000;
RATES[8] = (ALGEBRAIC[5] - STATES[8])/ALGEBRAIC[30];
ALGEBRAIC[31] =  1.33230*exp((( - ALGEBRAIC[17]*ALGEBRAIC[17])/14.2000)/14.2000)+0.0626000;
RATES[9] = (ALGEBRAIC[5] - STATES[9])/ALGEBRAIC[31];
ALGEBRAIC[19] = (STATES[0]+52.4500)/15.8827;
ALGEBRAIC[32] =  0.0256350*exp( - ALGEBRAIC[19]*ALGEBRAIC[19])+0.0141400;
ALGEBRAIC[7] = 1.00000/(1.00000+exp((STATES[0]+40.5000)/11.5000));
RATES[13] = (ALGEBRAIC[7] - STATES[13])/ALGEBRAIC[32];
ALGEBRAIC[22] = (STATES[0] - 20.0000)/20.0000;
ALGEBRAIC[33] = 0.700000+ 0.400000*exp( - ALGEBRAIC[22]*ALGEBRAIC[22]);
ALGEBRAIC[10] = 1.00000/(1.00000+exp((STATES[0] - 19.9000)/- 12.7000));
RATES[16] = (ALGEBRAIC[10] - STATES[16])/ALGEBRAIC[33];
ALGEBRAIC[23] = (STATES[0]+20.1376)/22.1996;
ALGEBRAIC[34] = 0.0311800+ 0.217180*exp( - ALGEBRAIC[23]*ALGEBRAIC[23]);
ALGEBRAIC[11] = 1.00000/(1.00000+exp((STATES[0]+15.0000)/- 6.00000));
RATES[17] = (ALGEBRAIC[11] - STATES[17])/ALGEBRAIC[34];
ALGEBRAIC[13] = STATES[6]/(STATES[6]+CONSTANTS[50]);
ALGEBRAIC[36] =  ALGEBRAIC[13]*ALGEBRAIC[13]*ALGEBRAIC[13]*ALGEBRAIC[13];
ALGEBRAIC[25] = STATES[19]/(STATES[19]+CONSTANTS[49]);
ALGEBRAIC[38] =  ALGEBRAIC[25]*ALGEBRAIC[25]*ALGEBRAIC[25]*ALGEBRAIC[25];
ALGEBRAIC[40] =  203.800*(ALGEBRAIC[38]+ALGEBRAIC[36]);
RATES[28] =  CONSTANTS[47]*((1.00000 - STATES[28]) - STATES[29]) -  ALGEBRAIC[40]*STATES[28];
ALGEBRAIC[42] = 33.9600+ 339.600*ALGEBRAIC[38];
RATES[29] =  ALGEBRAIC[40]*STATES[28] -  ALGEBRAIC[42]*STATES[29];
ALGEBRAIC[43] =  (( CONSTANTS[0]*CONSTANTS[1])/CONSTANTS[2])*log(STATES[10]/STATES[11]);
ALGEBRAIC[44] =  CONSTANTS[12]*STATES[12]*STATES[13]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[45] =  CONSTANTS[13]*STATES[14]*STATES[15]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[46] = ( CONSTANTS[14]*pow(STATES[10]/1.00000, 0.445700)*(STATES[0] - ALGEBRAIC[43]))/(1.00000+exp(( 1.50000*((STATES[0] - ALGEBRAIC[43])+3.60000)*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])));
ALGEBRAIC[48] = 1.00000/(1.00000+exp((STATES[0]+55.0000)/24.0000));
ALGEBRAIC[49] =  CONSTANTS[16]*STATES[17]*ALGEBRAIC[48]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[47] =  CONSTANTS[15]*STATES[16]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[53] = pow(STATES[2], 1.50000);
ALGEBRAIC[54] = ( (( (( CONSTANTS[20]*STATES[10])/(STATES[10]+CONSTANTS[19]))*ALGEBRAIC[53])/(ALGEBRAIC[53]+CONSTANTS[21]))*(STATES[0]+150.000))/(STATES[0]+200.000);
ALGEBRAIC[1] =  floor(VOI/CONSTANTS[5])*CONSTANTS[5];
ALGEBRAIC[24] = CONSTANTS[7]; // (VOI - ALGEBRAIC[1]>=CONSTANTS[4]&&VOI - ALGEBRAIC[1]<=CONSTANTS[4]+CONSTANTS[6] ? CONSTANTS[7] : 0.00000);
RATES[11] = - (((ALGEBRAIC[44]+ALGEBRAIC[45]+ALGEBRAIC[46]+ALGEBRAIC[47]+ALGEBRAIC[49]) -  2.00000*ALGEBRAIC[54])+ ALGEBRAIC[24]*CONSTANTS[3])/( CONSTANTS[29]*CONSTANTS[2]);
RATES[10] = (CONSTANTS[39] - STATES[10])/CONSTANTS[35]+((ALGEBRAIC[44]+ALGEBRAIC[45]+ALGEBRAIC[46]+ALGEBRAIC[47]+ALGEBRAIC[49]) -  2.00000*ALGEBRAIC[54])/( CONSTANTS[33]*CONSTANTS[2]);
ALGEBRAIC[35] =  (( CONSTANTS[0]*CONSTANTS[1])/CONSTANTS[2])*log(STATES[1]/STATES[2]);
ALGEBRAIC[37] = ( (( CONSTANTS[8]*STATES[3]*STATES[3]*STATES[3]*( 0.900000*STATES[4]+ 0.100000*STATES[5])*STATES[1]*STATES[0]*CONSTANTS[2]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1]))*(exp(( (STATES[0] - ALGEBRAIC[35])*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])) - 1.00000))/(exp(( STATES[0]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])) - 1.00000);
ALGEBRAIC[50] =  CONSTANTS[17]*(STATES[0] - ALGEBRAIC[35]);
ALGEBRAIC[56] = ( CONSTANTS[24]*( STATES[2]*STATES[2]*STATES[2]*STATES[18]*exp(( CONSTANTS[2]*STATES[0]*CONSTANTS[26])/( CONSTANTS[0]*CONSTANTS[1])) -  STATES[1]*STATES[1]*STATES[1]*STATES[19]*exp(( (CONSTANTS[26] - 1.00000)*STATES[0]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1]))))/(1.00000+ CONSTANTS[25]*( STATES[1]*STATES[1]*STATES[1]*STATES[19]+ STATES[2]*STATES[2]*STATES[2]*STATES[18]));
RATES[2] = - (ALGEBRAIC[37]+ALGEBRAIC[50]+ 3.00000*ALGEBRAIC[56]+ 3.00000*ALGEBRAIC[54]+CONSTANTS[28])/( CONSTANTS[29]*CONSTANTS[2]);
ALGEBRAIC[39] = STATES[6]/(STATES[6]+CONSTANTS[11]);

    //  TODO: make ICaL ( A[41] ) modification clear
    //  ALGEBRAIC[41] =  CONSTANTS[9]*STATES[7]*( ALGEBRAIC[39]*STATES[8]+ (1.00000 - ALGEBRAIC[39])*STATES[9])*(STATES[0] - CONSTANTS[10]);
    //  C[10] is E_Ca_app
    double E_Ca = ((CONSTANTS[0] * CONSTANTS[1]) / (2. * CONSTANTS[2])) * log(STATES[18] / STATES[6]);  //  C->R * C->T / (2 * C->F) * log(S->Ca_c / S->Ca_d)
    ALGEBRAIC[41] = CONSTANTS[9] * STATES[7] * (ALGEBRAIC[39] * STATES[8] + (1. - ALGEBRAIC[39]) * STATES[9]) * (STATES[0] - E_Ca);

ALGEBRAIC[51] =  (( CONSTANTS[0]*CONSTANTS[1])/( 2.00000*CONSTANTS[2]))*log(STATES[18]/STATES[19]);
ALGEBRAIC[52] =  CONSTANTS[18]*(STATES[0] - ALGEBRAIC[51]);
ALGEBRAIC[55] = ( CONSTANTS[22]*STATES[19])/(STATES[19]+CONSTANTS[23]);
RATES[18] = (CONSTANTS[38] - STATES[18])/CONSTANTS[36]+((ALGEBRAIC[41]+ALGEBRAIC[52]+ALGEBRAIC[55]) -  2.00000*ALGEBRAIC[56])/( 2.00000*CONSTANTS[33]*CONSTANTS[2]);
RATES[1] = (CONSTANTS[37] - STATES[1])/CONSTANTS[34]+(ALGEBRAIC[37]+ALGEBRAIC[50]+ 3.00000*ALGEBRAIC[56]+ 3.00000*ALGEBRAIC[54]+CONSTANTS[28])/( CONSTANTS[33]*CONSTANTS[2]);
ALGEBRAIC[58] = ( (STATES[6] - STATES[19])*2.00000*CONSTANTS[30]*CONSTANTS[2])/CONSTANTS[31];
RATES[6] = - (ALGEBRAIC[41]+ALGEBRAIC[58])/( 2.00000*CONSTANTS[30]*CONSTANTS[2]);
ALGEBRAIC[57] =  (10.0000/(1.00000+( 9.13652*pow(1.00000, 0.477811))/pow(CONSTANTS[27], 0.477811)))*(0.0517000+0.451600/(1.00000+exp((STATES[0]+59.5300)/17.1800)))*(STATES[0] - ALGEBRAIC[43])*CONSTANTS[3];
ALGEBRAIC[59] = (ALGEBRAIC[37]+ALGEBRAIC[41]+ALGEBRAIC[44]+ALGEBRAIC[45]+ALGEBRAIC[46]+ALGEBRAIC[49]+ALGEBRAIC[47]+ALGEBRAIC[50]+ALGEBRAIC[52]+ALGEBRAIC[54]+ALGEBRAIC[55]+ALGEBRAIC[56]+ALGEBRAIC[57])/CONSTANTS[3]+ALGEBRAIC[24];
RATES[0] =  - ALGEBRAIC[59]*1000.00;
ALGEBRAIC[60] =  200000.*STATES[19]*(1.00000 - STATES[20]) -  476.000*STATES[20];
RATES[20] = ALGEBRAIC[60];
ALGEBRAIC[61] =  78400.0*STATES[19]*(1.00000 - STATES[21]) -  392.000*STATES[21];
RATES[21] = ALGEBRAIC[61];
ALGEBRAIC[62] =  200000.*STATES[19]*((1.00000 - STATES[22]) - STATES[23]) -  6.60000*STATES[22];
RATES[22] = ALGEBRAIC[62];
ALGEBRAIC[63] =  0.0800000*ALGEBRAIC[61]+ 0.160000*ALGEBRAIC[62]+ 0.0450000*ALGEBRAIC[60];
RATES[24] = ALGEBRAIC[63];
ALGEBRAIC[67] = ( CONSTANTS[40]*(STATES[19]/CONSTANTS[41] - ( CONSTANTS[43]*CONSTANTS[43]*STATES[26])/CONSTANTS[42]))/((STATES[19]+CONSTANTS[41])/CONSTANTS[41]+( CONSTANTS[43]*(STATES[26]+CONSTANTS[42]))/CONSTANTS[42]);
ALGEBRAIC[64] = STATES[29]/(STATES[29]+0.250000);
ALGEBRAIC[65] =  ALGEBRAIC[64]*ALGEBRAIC[64];
ALGEBRAIC[66] =  CONSTANTS[44]*ALGEBRAIC[65]*(STATES[25] - STATES[19]);
RATES[19] = - ((ALGEBRAIC[52]+ALGEBRAIC[55]+ALGEBRAIC[67]) - (ALGEBRAIC[58]+ALGEBRAIC[66]+ 2.00000*ALGEBRAIC[56]))/( 2.00000*CONSTANTS[29]*CONSTANTS[2]) -  1.00000*ALGEBRAIC[63];
ALGEBRAIC[68] = ( (STATES[26] - STATES[25])*2.00000*CONSTANTS[46]*CONSTANTS[2])/CONSTANTS[48];
RATES[26] = (ALGEBRAIC[67] - ALGEBRAIC[68])/( 2.00000*CONSTANTS[45]*CONSTANTS[2]);
ALGEBRAIC[69] =  480.000*STATES[25]*(1.00000 - STATES[27]) -  400.000*STATES[27];
RATES[27] = ALGEBRAIC[69];
RATES[25] = (ALGEBRAIC[68] - ALGEBRAIC[66])/( 2.00000*CONSTANTS[46]*CONSTANTS[2]) -  31.0000*ALGEBRAIC[69];

calc_fluo(VOI, CONSTANTS, RATES, STATES, ALGEBRAIC);
_calc_means(STATES, CONSTANTS);
calc_means(VOI, CONSTANTS, RATES, STATES, ALGEBRAIC);

}


void
computeVariables(double VOI, double* CONSTANTS, double* RATES, double* STATES, double* ALGEBRAIC) {
ALGEBRAIC[12] =  2000.00*CONSTANTS[32]*((1.00000 - STATES[22]) - STATES[23]) -  666.000*STATES[23];
ALGEBRAIC[18] =  0.00350000*exp((( - STATES[0]*STATES[0])/30.0000)/30.0000)+0.00150000;
ALGEBRAIC[6] = 1.00000/(1.00000+exp((STATES[0] - 1.00000)/- 11.0000));
ALGEBRAIC[8] = 1.00000/(1.00000+exp(- (STATES[0]+6.00000)/8.60000));
ALGEBRAIC[20] = 0.00900000/(1.00000+exp((STATES[0]+5.00000)/12.0000))+0.000500000;
ALGEBRAIC[9] = 1.00000/(1.00000+exp((STATES[0]+7.50000)/10.0000));
ALGEBRAIC[21] = 0.590000/(1.00000+exp((STATES[0]+60.0000)/10.0000))+3.05000;
ALGEBRAIC[14] = 1.00000/(1.00000+exp((STATES[0]+27.1200)/- 8.21000));
ALGEBRAIC[2] = (STATES[0]+25.5700)/28.8000;
ALGEBRAIC[26] =  4.20000e-05*exp( - ALGEBRAIC[2]*ALGEBRAIC[2])+2.40000e-05;
ALGEBRAIC[3] = 1.00000/(1.00000+exp((STATES[0]+63.6000)/5.30000));
ALGEBRAIC[15] = 1.00000/(1.00000+exp((STATES[0]+35.1000)/3.20000));
ALGEBRAIC[27] =  0.0300000*ALGEBRAIC[15]+0.000300000;
ALGEBRAIC[28] =  0.120000*ALGEBRAIC[15]+0.00300000;
ALGEBRAIC[4] = 1.00000/(1.00000+exp((STATES[0]+9.00000)/- 5.80000));
ALGEBRAIC[16] = (STATES[0]+35.0000)/30.0000;
ALGEBRAIC[29] =  0.00270000*exp( - ALGEBRAIC[16]*ALGEBRAIC[16])+0.00200000;
ALGEBRAIC[5] = 1.00000/(1.00000+exp((STATES[0]+27.4000)/7.10000));
ALGEBRAIC[17] = STATES[0]+40.0000;
ALGEBRAIC[30] =  0.161000*exp((( - ALGEBRAIC[17]*ALGEBRAIC[17])/14.4000)/14.4000)+0.0100000;
ALGEBRAIC[31] =  1.33230*exp((( - ALGEBRAIC[17]*ALGEBRAIC[17])/14.2000)/14.2000)+0.0626000;
ALGEBRAIC[19] = (STATES[0]+52.4500)/15.8827;
ALGEBRAIC[32] =  0.0256350*exp( - ALGEBRAIC[19]*ALGEBRAIC[19])+0.0141400;
ALGEBRAIC[7] = 1.00000/(1.00000+exp((STATES[0]+40.5000)/11.5000));
ALGEBRAIC[22] = (STATES[0] - 20.0000)/20.0000;
ALGEBRAIC[33] = 0.700000+ 0.400000*exp( - ALGEBRAIC[22]*ALGEBRAIC[22]);
ALGEBRAIC[10] = 1.00000/(1.00000+exp((STATES[0] - 19.9000)/- 12.7000));
ALGEBRAIC[23] = (STATES[0]+20.1376)/22.1996;
ALGEBRAIC[34] = 0.0311800+ 0.217180*exp( - ALGEBRAIC[23]*ALGEBRAIC[23]);
ALGEBRAIC[11] = 1.00000/(1.00000+exp((STATES[0]+15.0000)/- 6.00000));
ALGEBRAIC[13] = STATES[6]/(STATES[6]+CONSTANTS[50]);
ALGEBRAIC[36] =  ALGEBRAIC[13]*ALGEBRAIC[13]*ALGEBRAIC[13]*ALGEBRAIC[13];
ALGEBRAIC[25] = STATES[19]/(STATES[19]+CONSTANTS[49]);
ALGEBRAIC[38] =  ALGEBRAIC[25]*ALGEBRAIC[25]*ALGEBRAIC[25]*ALGEBRAIC[25];
ALGEBRAIC[40] =  203.800*(ALGEBRAIC[38]+ALGEBRAIC[36]);
ALGEBRAIC[42] = 33.9600+ 339.600*ALGEBRAIC[38];
ALGEBRAIC[43] =  (( CONSTANTS[0]*CONSTANTS[1])/CONSTANTS[2])*log(STATES[10]/STATES[11]);
ALGEBRAIC[44] =  CONSTANTS[12]*STATES[12]*STATES[13]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[45] =  CONSTANTS[13]*STATES[14]*STATES[15]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[46] = ( CONSTANTS[14]*pow(STATES[10]/1.00000, 0.445700)*(STATES[0] - ALGEBRAIC[43]))/(1.00000+exp(( 1.50000*((STATES[0] - ALGEBRAIC[43])+3.60000)*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])));
ALGEBRAIC[48] = 1.00000/(1.00000+exp((STATES[0]+55.0000)/24.0000));
ALGEBRAIC[49] =  CONSTANTS[16]*STATES[17]*ALGEBRAIC[48]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[47] =  CONSTANTS[15]*STATES[16]*(STATES[0] - ALGEBRAIC[43]);
ALGEBRAIC[53] = pow(STATES[2], 1.50000);
ALGEBRAIC[54] = ( (( (( CONSTANTS[20]*STATES[10])/(STATES[10]+CONSTANTS[19]))*ALGEBRAIC[53])/(ALGEBRAIC[53]+CONSTANTS[21]))*(STATES[0]+150.000))/(STATES[0]+200.000);
ALGEBRAIC[1] =  floor(VOI/CONSTANTS[5])*CONSTANTS[5];
ALGEBRAIC[24] = CONSTANTS[7]; // (VOI - ALGEBRAIC[1]>=CONSTANTS[4]&&VOI - ALGEBRAIC[1]<=CONSTANTS[4]+CONSTANTS[6] ? CONSTANTS[7] : 0.00000);
ALGEBRAIC[35] =  (( CONSTANTS[0]*CONSTANTS[1])/CONSTANTS[2])*log(STATES[1]/STATES[2]);
ALGEBRAIC[37] = ( (( CONSTANTS[8]*STATES[3]*STATES[3]*STATES[3]*( 0.900000*STATES[4]+ 0.100000*STATES[5])*STATES[1]*STATES[0]*CONSTANTS[2]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1]))*(exp(( (STATES[0] - ALGEBRAIC[35])*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])) - 1.00000))/(exp(( STATES[0]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1])) - 1.00000);
ALGEBRAIC[50] =  CONSTANTS[17]*(STATES[0] - ALGEBRAIC[35]);
ALGEBRAIC[56] = ( CONSTANTS[24]*( STATES[2]*STATES[2]*STATES[2]*STATES[18]*exp(( CONSTANTS[2]*STATES[0]*CONSTANTS[26])/( CONSTANTS[0]*CONSTANTS[1])) -  STATES[1]*STATES[1]*STATES[1]*STATES[19]*exp(( (CONSTANTS[26] - 1.00000)*STATES[0]*CONSTANTS[2])/( CONSTANTS[0]*CONSTANTS[1]))))/(1.00000+ CONSTANTS[25]*( STATES[1]*STATES[1]*STATES[1]*STATES[19]+ STATES[2]*STATES[2]*STATES[2]*STATES[18]));
ALGEBRAIC[39] = STATES[6]/(STATES[6]+CONSTANTS[11]);


    //  TODO: make ICaL ( A[41] ) modification clear
    //  ALGEBRAIC[41] =  CONSTANTS[9]*STATES[7]*( ALGEBRAIC[39]*STATES[8]+ (1.00000 - ALGEBRAIC[39])*STATES[9])*(STATES[0] - CONSTANTS[10]);
    //  C[10] is E_Ca_app
    double E_Ca = ((CONSTANTS[0] * CONSTANTS[1]) / (2. * CONSTANTS[2])) * log(STATES[18] / STATES[6]);  //  C->R * C->T / (2 * C->F) * log(S->Ca_c / S->Ca_d)
    ALGEBRAIC[41] = CONSTANTS[9] * STATES[7] * (ALGEBRAIC[39] * STATES[8] + (1. - ALGEBRAIC[39]) * STATES[9]) * (STATES[0] - E_Ca);


ALGEBRAIC[51] =  (( CONSTANTS[0]*CONSTANTS[1])/( 2.00000*CONSTANTS[2]))*log(STATES[18]/STATES[19]);
ALGEBRAIC[52] =  CONSTANTS[18]*(STATES[0] - ALGEBRAIC[51]);
ALGEBRAIC[55] = ( CONSTANTS[22]*STATES[19])/(STATES[19]+CONSTANTS[23]);
ALGEBRAIC[58] = ( (STATES[6] - STATES[19])*2.00000*CONSTANTS[30]*CONSTANTS[2])/CONSTANTS[31];
ALGEBRAIC[57] =  (10.0000/(1.00000+( 9.13652*pow(1.00000, 0.477811))/pow(CONSTANTS[27], 0.477811)))*(0.0517000+0.451600/(1.00000+exp((STATES[0]+59.5300)/17.1800)))*(STATES[0] - ALGEBRAIC[43])*CONSTANTS[3];
ALGEBRAIC[59] = (ALGEBRAIC[37]+ALGEBRAIC[41]+ALGEBRAIC[44]+ALGEBRAIC[45]+ALGEBRAIC[46]+ALGEBRAIC[49]+ALGEBRAIC[47]+ALGEBRAIC[50]+ALGEBRAIC[52]+ALGEBRAIC[54]+ALGEBRAIC[55]+ALGEBRAIC[56]+ALGEBRAIC[57])/CONSTANTS[3]+ALGEBRAIC[24];
ALGEBRAIC[60] =  200000.*STATES[19]*(1.00000 - STATES[20]) -  476.000*STATES[20];
ALGEBRAIC[61] =  78400.0*STATES[19]*(1.00000 - STATES[21]) -  392.000*STATES[21];
ALGEBRAIC[62] =  200000.*STATES[19]*((1.00000 - STATES[22]) - STATES[23]) -  6.60000*STATES[22];
ALGEBRAIC[63] =  0.0800000*ALGEBRAIC[61]+ 0.160000*ALGEBRAIC[62]+ 0.0450000*ALGEBRAIC[60];
ALGEBRAIC[67] = ( CONSTANTS[40]*(STATES[19]/CONSTANTS[41] - ( CONSTANTS[43]*CONSTANTS[43]*STATES[26])/CONSTANTS[42]))/((STATES[19]+CONSTANTS[41])/CONSTANTS[41]+( CONSTANTS[43]*(STATES[26]+CONSTANTS[42]))/CONSTANTS[42]);
ALGEBRAIC[64] = STATES[29]/(STATES[29]+0.250000);
ALGEBRAIC[65] =  ALGEBRAIC[64]*ALGEBRAIC[64];
ALGEBRAIC[66] =  CONSTANTS[44]*ALGEBRAIC[65]*(STATES[25] - STATES[19]);
ALGEBRAIC[68] = ( (STATES[26] - STATES[25])*2.00000*CONSTANTS[46]*CONSTANTS[2])/CONSTANTS[48];
ALGEBRAIC[69] =  480.000*STATES[25]*(1.00000 - STATES[27]) -  400.000*STATES[27];
ALGEBRAIC[0] =  0.0500000*STATES[0];

// calc_fluo(VOI, CONSTANTS, RATES, STATES, ALGEBRAIC);
// _calc_means(STATES, CONSTANTS);
// calc_means(VOI, CONSTANTS, RATES, STATES, ALGEBRAIC);

}


void computeVariablesVec(const int states_input_length, double* constants, double* states_input,
                         double* algebraic_output) {
    double rates[S_SIZE];
    for (int i = 0; i < states_input_length; ++i) {
        computeVariables(0., constants, rates, &states_input[i * S_SIZE], &algebraic_output[i * A_SIZE]);
    }
}
